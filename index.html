<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#f7a8c7" />
  <title>Валентинка</title>
  <style>
    :root {
      --bg-1: #ffd1e2;
      --bg-2: #f8b6cf;
      --bg-3: #f6e4ff;
      --pink-100: #ffe8f2;
      --pink-200: #ffd7e8;
      --pink-300: #ffc2dd;
      --pink-500: #ff73aa;
      --rose-500: #ff5f8a;
      --violet-500: #b56cff;
      --text-main: #4a2140;
      --text-soft: #6f3f60;
      --glass-bg: rgba(255, 255, 255, 0.26);
      --glass-border: rgba(255, 255, 255, 0.46);
      --shadow-1: 0 16px 40px rgba(124, 38, 97, 0.22);
      --shadow-2: 0 8px 24px rgba(255, 96, 138, 0.2);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --button-height: 46px;
      --ease-spring: cubic-bezier(0.2, 0.95, 0.32, 1.12);
      --ease-soft: cubic-bezier(0.22, 0.61, 0.36, 1);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html,
    body {
      margin: 0;
      min-height: 100%;
      font-family: "Segoe UI", "SF Pro Text", "Helvetica Neue", sans-serif;
      color: var(--text-main);
      background: radial-gradient(140% 100% at 10% 10%, #ffdff0 0%, transparent 56%),
        radial-gradient(120% 90% at 90% 0%, #f0ceff 0%, transparent 54%),
        linear-gradient(145deg, var(--bg-1) 0%, var(--bg-2) 56%, var(--bg-3) 100%);
      overflow-x: hidden;
    }

    body {
      display: grid;
      place-items: center;
      padding: 14px;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 650ms var(--ease-soft), transform 650ms var(--ease-soft);
    }

    body.ready {
      opacity: 1;
      transform: none;
    }

    .ambient-glow {
      position: fixed;
      inset: -18vmax;
      pointer-events: none;
      background: radial-gradient(circle at 40% 20%, rgba(255, 255, 255, 0.3), transparent 55%),
        radial-gradient(circle at 75% 80%, rgba(255, 132, 180, 0.24), transparent 48%);
      filter: blur(28px);
      z-index: 0;
    }

    .scene {
      position: relative;
      z-index: 2;
      width: min(100%, 430px);
      min-height: min(100svh - 24px, 760px);
      display: grid;
      grid-template-rows: 1fr auto auto;
      align-items: center;
      justify-items: center;
      gap: 16px;
      padding: 20px 14px 26px;
      isolation: isolate;
    }

    .floating-hearts {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }

    .float-heart {
      position: absolute;
      width: 18px;
      height: 18px;
      opacity: 0.75;
      animation: float-heart var(--dur, 8s) ease-in-out infinite;
      animation-delay: var(--delay, 0s);
      transform: translate3d(0, 0, 0);
      will-change: transform, opacity;
    }

    .float-heart svg {
      display: block;
      width: 100%;
      height: 100%;
      filter: drop-shadow(0 3px 5px rgba(216, 60, 136, 0.2));
    }

    @keyframes float-heart {
      0%,
      100% {
        transform: translate3d(0, 0, 0) scale(0.92);
        opacity: 0.45;
      }
      50% {
        transform: translate3d(var(--drift, 12px), -24px, 0) scale(1.08);
        opacity: 0.88;
      }
    }

    .envelope-wrap {
      position: relative;
      z-index: 3;
      width: min(84vw, 320px);
      aspect-ratio: 4 / 3;
      perspective: 1100px;
      display: grid;
      place-items: center;
      user-select: none;
      cursor: pointer;
    }

    .envelope-wrap:focus-visible {
      outline: 2px solid rgba(255, 255, 255, 0.85);
      outline-offset: 6px;
      border-radius: 20px;
    }

    .envelope {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      border-radius: 20px;
      filter: drop-shadow(0 24px 28px rgba(149, 41, 108, 0.28));
      animation: envelope-idle 8.5s ease-in-out infinite;
      will-change: transform;
    }

    .envelope.stopped {
      animation-play-state: paused;
    }

    .envelope-body {
      position: absolute;
      inset: 0;
      border-radius: 20px;
      background: linear-gradient(156deg, #ffe6f2 0%, #ffc7dd 52%, #ffaecf 100%);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.82),
        inset 0 -12px 16px rgba(226, 95, 149, 0.24),
        var(--shadow-1);
      overflow: hidden;
      transform: translateZ(0);
    }

    .envelope-body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(130deg, rgba(255, 255, 255, 0.35), transparent 46%),
        repeating-linear-gradient(
          130deg,
          rgba(255, 255, 255, 0.05) 0,
          rgba(255, 255, 255, 0.05) 2px,
          rgba(0, 0, 0, 0.02) 2px,
          rgba(0, 0, 0, 0.02) 4px
        );
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .envelope-front {
      position: absolute;
      inset: 0;
      clip-path: polygon(0 0, 50% 58%, 100% 0, 100% 100%, 0 100%);
      border-radius: 20px;
      background: linear-gradient(175deg, #ffc0db 0%, #ff9fc6 100%);
      transform: translateZ(1px);
      box-shadow: inset 0 3px 7px rgba(255, 255, 255, 0.55),
        inset 0 -6px 11px rgba(156, 47, 108, 0.2);
      z-index: 3;
      pointer-events: none;
    }

    .envelope-flap {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 55%;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      background: linear-gradient(160deg, #ffd4e7 0%, #ff9dc4 100%);
      transform-origin: top center;
      transform: rotateX(0deg) translateZ(2px);
      transition: transform 700ms var(--ease-soft), filter 500ms var(--ease-soft);
      box-shadow: inset 0 2px 8px rgba(255, 255, 255, 0.5);
      z-index: 5;
      pointer-events: none;
    }

    .seal {
      position: absolute;
      left: 50%;
      top: 46%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: radial-gradient(circle at 35% 28%, #ffedf6 0%, #ff8db8 55%, #ff5d94 100%);
      box-shadow: 0 6px 14px rgba(196, 42, 116, 0.3),
        inset 0 1px 2px rgba(255, 255, 255, 0.72);
      display: grid;
      place-items: center;
      z-index: 6;
      transition: opacity 280ms ease;
      pointer-events: none;
    }

    .seal svg {
      width: 18px;
      height: 18px;
      fill: #fff;
    }

    .letter {
      position: absolute;
      left: 50%;
      bottom: 12%;
      transform: translate(-50%, 72%) scale(0.98);
      width: 90%;
      max-height: min(58svh, 430px);
      padding: 16px 14px 14px;
      border-radius: var(--radius-xl);
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: var(--shadow-2), inset 0 1px 0 rgba(255, 255, 255, 0.58);
      z-index: 7;
      opacity: 0;
      pointer-events: none;
      transition: transform 720ms var(--ease-spring), opacity 420ms ease;
      will-change: transform, opacity;
      overflow: auto;
      overscroll-behavior: contain;
    }

    .letter h1 {
      margin: 0;
      font-size: clamp(1.15rem, 4vw, 1.45rem);
      line-height: 1.2;
      letter-spacing: 0.01em;
    }

    .letter p {
      margin: 10px 0 0;
      font-size: clamp(0.94rem, 3.7vw, 1.02rem);
      line-height: 1.5;
      color: var(--text-soft);
    }

    .letter .stamp {
      margin-top: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      color: #7f2f66;
      background: rgba(255, 255, 255, 0.45);
      border: 1px solid rgba(255, 255, 255, 0.55);
      border-radius: 999px;
      padding: 7px 10px;
      font-size: 0.84rem;
    }

    .letter .stamp svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
    }

    .hint {
      position: relative;
      z-index: 4;
      margin-top: 6px;
      font-size: 0.93rem;
      color: #7a3f62;
      background: rgba(255, 255, 255, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 999px;
      padding: 9px 14px;
      box-shadow: 0 8px 20px rgba(173, 74, 125, 0.14);
      transition: opacity 260ms ease, transform 260ms ease;
    }

    .actions {
      width: 100%;
      max-width: 360px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      z-index: 4;
    }

    .btn {
      position: relative;
      height: var(--button-height);
      border: 0;
      border-radius: var(--radius-lg);
      font-size: 0.96rem;
      font-weight: 700;
      letter-spacing: 0.02em;
      color: #fff;
      background: linear-gradient(160deg, var(--pink-500), var(--rose-500));
      box-shadow: 0 10px 20px rgba(232, 72, 142, 0.28);
      transition: transform 170ms ease, filter 170ms ease, opacity 170ms ease;
      will-change: transform;
      cursor: pointer;
    }

    .btn-secondary {
      background: linear-gradient(160deg, #d68dff, #ba77f6);
      box-shadow: 0 10px 20px rgba(152, 90, 223, 0.25);
    }

    .btn:active {
      transform: translateY(2px) scale(0.98);
    }

    .btn[disabled] {
      opacity: 0.55;
      cursor: default;
      transform: none;
    }

    @media (hover: hover) and (pointer: fine) {
      .btn:hover {
        transform: translateY(-2px) scale(1.01);
        filter: brightness(1.03);
      }

      .envelope-wrap:hover .envelope {
        transform: rotateY(-7deg) rotateX(2deg) translateY(-1px);
      }
    }

    .open .envelope {
      animation: none;
      transform: rotateY(0deg);
    }

    .open .envelope-flap {
      transform: rotateX(-168deg) translateZ(2px);
      filter: brightness(1.03);
    }

    .open .seal {
      opacity: 0;
    }

    .open .letter {
      transform: translate(-50%, 16%) scale(1);
      opacity: 1;
      pointer-events: auto;
    }

    .open .hint {
      opacity: 0;
      transform: translateY(-6px);
    }

    .confetti-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 9;
    }

    .confetti {
      position: absolute;
      width: var(--size, 8px);
      height: calc(var(--size, 8px) * 1.35);
      left: var(--x, 50%);
      top: var(--y, 42%);
      border-radius: 2px;
      background: var(--c, #ff82b3);
      opacity: 0.95;
      transform: translate3d(-50%, -50%, 0) rotate(0deg);
      animation: confetti-shot var(--life, 1200ms) linear forwards;
      will-change: transform, opacity;
    }

    @keyframes confetti-shot {
      0% {
        transform: translate3d(-50%, -50%, 0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translate3d(calc(-50% + var(--tx)), calc(-50% + var(--ty)), 0)
          rotate(var(--rot));
        opacity: 0;
      }
    }

    @keyframes envelope-idle {
      0%,
      100% {
        transform: rotateY(0deg) rotateX(0deg);
      }
      25% {
        transform: rotateY(-9deg) rotateX(2deg);
      }
      50% {
        transform: rotateY(0deg) rotateX(-1.5deg);
      }
      75% {
        transform: rotateY(9deg) rotateX(2deg);
      }
    }

    @media (min-width: 560px) {
      .scene {
        min-height: min(100svh - 28px, 830px);
        gap: 18px;
      }

      .actions {
        grid-template-columns: 1fr 1fr;
      }

      .letter {
        padding: 18px 18px 16px;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }

      .float-heart {
        opacity: 0.5;
      }

      body {
        opacity: 1;
        transform: none;
      }

      .open .letter {
        transform: translate(-50%, 18%) scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="ambient-glow" aria-hidden="true"></div>

  <main class="scene" id="scene">
    <div class="floating-hearts" aria-hidden="true" id="floatingHearts"></div>

    <div class="envelope-wrap" id="envelopeWrap" role="button" tabindex="0" aria-label="Открыть письмо">
      <div class="envelope" id="envelope">
        <div class="envelope-body"></div>
        <div class="letter" id="letter" aria-live="polite">
          <h1>Даня, с 14 февраля 💖</h1>
          <p>Ты самый глупый умный, интересный балбес на планете.</p>
          <p>С тобой всегда как в комедии: смешно, тепло и немного хаос.</p>
          <p>Спасибо, что ты есть.</p>
          <p>Если бы у заботы был звук, это был бы твой фирменный "ну ща разберёмся".</p>
          <p>Ты как Wi-Fi в метро: иногда странный, но без тебя всё сразу грустнее.</p>
          <p>Обещаю и дальше смеяться с твоих шуток даже тогда, когда они уровня "папин стендап".</p>
          <p>Официально заявляю: в рейтинге лучших людей ты стабильно в топе, без накруток.</p>
          <p class="stamp">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21s-7.7-4.9-9.7-9.2c-1.4-3.1.2-6.6 3.4-7.6A5.4 5.4 0 0 1 12 6.1a5.4 5.4 0 0 1 6.3-1.9c3.2 1 4.8 4.5 3.4 7.6C19.7 16.1 12 21 12 21z"/></svg>
            P.S. Это официальное письмо, печать — сердечко. 💌
          </p>
        </div>
        <div class="envelope-front"></div>
        <div class="envelope-flap"></div>
        <div class="seal" aria-hidden="true">
          <svg viewBox="0 0 24 24"><path d="M12 21s-7.7-4.9-9.7-9.2c-1.4-3.1.2-6.6 3.4-7.6A5.4 5.4 0 0 1 12 6.1a5.4 5.4 0 0 1 6.3-1.9c3.2 1 4.8 4.5 3.4 7.6C19.7 16.1 12 21 12 21z"/></svg>
        </div>
      </div>
    </div>

    <div class="hint" id="hint">Нажми, чтобы открыть</div>

    <div class="actions">
      <button class="btn" id="confettiBtn" type="button" disabled>Ещё конфетти</button>
      <button class="btn btn-secondary" id="closeBtn" type="button" disabled>Закрыть письмо</button>
    </div>
  </main>

  <div class="confetti-layer" id="confettiLayer" aria-hidden="true"></div>

  <script>
    (function () {
      const scene = document.getElementById("scene");
      const envelopeWrap = document.getElementById("envelopeWrap");
      const envelope = document.getElementById("envelope");
      const confettiLayer = document.getElementById("confettiLayer");
      const confettiBtn = document.getElementById("confettiBtn");
      const closeBtn = document.getElementById("closeBtn");
      const floatingHearts = document.getElementById("floatingHearts");
      const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      let isOpen = false;
      let confettiCooldown = false;

      const heartColorPalette = ["#ff8cb8", "#ff6ea5", "#ffc2dd", "#d894ff", "#ffffff"];

      function makeHeartSvg(color) {
        return `<svg viewBox="0 0 24 24" aria-hidden="true"><path fill="${color}" d="M12 21s-7.7-4.9-9.7-9.2c-1.4-3.1.2-6.6 3.4-7.6A5.4 5.4 0 0 1 12 6.1a5.4 5.4 0 0 1 6.3-1.9c3.2 1 4.8 4.5 3.4 7.6C19.7 16.1 12 21 12 21z"/></svg>`;
      }

      function renderFloatingHearts() {
        const count = prefersReduced ? 4 : 8;
        const fragment = document.createDocumentFragment();

        for (let i = 0; i < count; i += 1) {
          const node = document.createElement("span");
          node.className = "float-heart";
          node.style.left = `${8 + Math.random() * 84}%`;
          node.style.top = `${6 + Math.random() * 82}%`;
          node.style.setProperty("--dur", `${7 + Math.random() * 5}s`);
          node.style.setProperty("--delay", `${Math.random() * 2.6}s`);
          node.style.setProperty("--drift", `${-14 + Math.random() * 28}px`);
          node.innerHTML = makeHeartSvg(heartColorPalette[i % heartColorPalette.length]);
          fragment.appendChild(node);
        }

        floatingHearts.appendChild(fragment);
      }

      function setOpenState(nextState) {
        isOpen = nextState;
        scene.classList.toggle("open", isOpen);
        envelope.classList.toggle("stopped", isOpen);

        confettiBtn.disabled = !isOpen;
        closeBtn.disabled = !isOpen;
      }

      function spawnConfettiBurst() {
        // Короткий залп с ограничением количества частиц для слабых устройств.
        const particleCount = prefersReduced ? 34 : 96;
        const colors = ["#ff8bb8", "#ff6ca0", "#ffffff", "#ffd2ea", "#cf9bff"];

        for (let i = 0; i < particleCount; i += 1) {
          const confetti = document.createElement("span");
          confetti.className = "confetti";

          const angle = (-85 + Math.random() * 170) * (Math.PI / 180);
          const power = 90 + Math.random() * 250;
          const tx = Math.cos(angle) * power;
          const ty = Math.sin(angle) * power + 120 + Math.random() * 130;

          confetti.style.setProperty("--x", `${44 + Math.random() * 12}%`);
          confetti.style.setProperty("--y", `${44 + Math.random() * 10}%`);
          confetti.style.setProperty("--tx", `${tx.toFixed(1)}px`);
          confetti.style.setProperty("--ty", `${ty.toFixed(1)}px`);
          confetti.style.setProperty("--rot", `${Math.round(-520 + Math.random() * 1040)}deg`);
          confetti.style.setProperty("--size", `${5 + Math.random() * 6}px`);
          confetti.style.setProperty("--life", `${900 + Math.random() * 500}ms`);
          confetti.style.setProperty("--c", colors[Math.floor(Math.random() * colors.length)]);

          confettiLayer.appendChild(confetti);
          setTimeout(() => confetti.remove(), 1500);
        }
      }

      function triggerConfettiWithCooldown() {
        if (confettiCooldown || !isOpen) {
          return;
        }

        spawnConfettiBurst();
        confettiCooldown = true;
        confettiBtn.disabled = true;

        window.setTimeout(() => {
          confettiCooldown = false;
          confettiBtn.disabled = !isOpen;
        }, 2000);
      }

      function openLetter() {
        if (isOpen) {
          return;
        }
        setOpenState(true);
        spawnConfettiBurst();
      }

      function closeLetter() {
        if (!isOpen) {
          return;
        }

        setOpenState(false);
      }

      envelopeWrap.addEventListener("click", openLetter, { passive: true });
      envelopeWrap.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          openLetter();
        }
      });

      confettiBtn.addEventListener("click", triggerConfettiWithCooldown, { passive: true });
      closeBtn.addEventListener("click", closeLetter, { passive: true });

      renderFloatingHearts();
      setOpenState(false);

      requestAnimationFrame(() => {
        document.body.classList.add("ready");
      });
    })();
  </script>
</body>
</html>
